<!DOCTYPE html>

<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>글쓰기 · ENGYU</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --accent: #3b82f6;
        --muted: #6b7280;
        --bg: #f8fafc;
        --card: #fff;
        --text: #0f1724;
        --border: #e6e9ef;
        --shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      }
      * {
        box-sizing: border-box;
      }
      body {
        font-family: Inter, system-ui, Arial;
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--text);
      }
      .wrap {
        max-width: 980px;
        margin: 24px auto;
        padding: 0 12px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }
      .nav {
        display: flex;
        gap: 8px;
      }
      a.btn,
      button.btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        border-radius: 10px;
        border: 1px solid var(--border);
        cursor: pointer;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.2s;
      }
      a.btn {
        background: transparent;
        color: var(--muted);
      }
      a.btn:hover {
        background: var(--bg);
        border-color: var(--accent);
        color: var(--accent);
      }
      button.primary {
        background: var(--accent);
        color: #fff;
        border: none;
      }
      button.primary:hover {
        opacity: 0.9;
      }
      .meta {
        display: flex;
        gap: 8px;
        align-items: center;
        font-size: 13px;
        color: var(--muted);
      }
      input.title {
        flex: 1;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid var(--border);
        font-size: 16px;
        outline: none;
      }
      input.title:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
      }
      .editor {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 12px;
      }
      .card {
        background: var(--card);
        padding: 16px;
        border-radius: 12px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
      }
      .editor-main {
        display: flex;
        flex-direction: column;
        gap: 12px;
        min-height: 500px;
      }
      .toolbar {
        display: flex;
        gap: 6px;
      }
      .toolbar button {
        padding: 6px 10px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: var(--bg);
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
      }
      .toolbar button:hover {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent);
      }
      .content {
        flex: 1;
        border-radius: 8px;
        padding: 10px;
        border: 1px solid var(--border);
        min-height: 260px;
        outline: none;
        overflow: auto;
        background: #fefefe;
      }
      .side {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 8px;
      }
      label {
        font-size: 13px;
        color: var(--muted);
      }
      .previewArea {
        background: #0b1220;
        color: #e6eefb;
        padding: 10px;
        border-radius: 8px;
        min-height: 200px;
        overflow: auto;
        font-family: monospace;
        font-size: 14px;
      }
      footer {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }
      @media (max-width: 980px) {
        .editor {
          grid-template-columns: 1fr;
        }
        .side {
          order: 2;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <a href="index.html" class="btn" title="홈으로">◀ 홈</a>
          <a href="admin.html" class="btn" title="관리자">⚙ 관리자</a>
        </div>
        <div class="meta">임시 저장: localStorage에 보관됩니다</div>
      </header>

      ```
      <div class="editor">
        <div class="editor-main card">
          <input id="postTitle" class="title" placeholder="제목을 입력하세요" />

          <div class="toolbar" role="toolbar" aria-label="에디터 도구">
            <button data-cmd="bold" title="굵게 (Ctrl/Cmd+B)">B</button>
            <button data-cmd="italic" title="기울임 (Ctrl/Cmd+I)">I</button>
            <button data-cmd="link" title="링크 삽입">링크</button>
            <button id="togglePreview" title="미리보기 토글">미리보기</button>
            <button id="clearDraft" title="초기화">초기화</button>
          </div>

          <div
            id="editor"
            class="content"
            contenteditable="true"
            aria-label="글 내용 입력"
          ></div>

          <footer>
            <button id="saveDraft" class="btn">임시저장</button>
            <button id="exportBtn" class="btn">내보내기(.md)</button>
            <button id="publishBtn" class="btn primary">발행 (local)</button>
          </footer>
        </div>

        <aside class="side card">
          <div>
            <label>미리보기</label>
            <div id="preview" class="previewArea" aria-live="polite"></div>
          </div>
          <div class="row">
            <label>태그</label>
            <input
              id="tags"
              type="text"
              placeholder="쉼표로 구분"
              style="
                flex: 1;
                padding: 8px;
                border-radius: 8px;
                border: 1px solid var(--border);
              "
            />
          </div>
          <div class="row">
            <label>상태</label>
            <select
              id="status"
              style="
                padding: 8px;
                border-radius: 8px;
                border: 1px solid var(--border);
              "
            >
              <option value="draft">임시</option>
              <option value="published">발행</option>
            </select>
          </div>
          <div class="row" style="margin-top: 12px">
            <button id="loadDraft" class="btn">불러오기</button>
            <button id="deleteDraft" class="btn">삭제</button>
          </div>
        </aside>
      </div>
      ```
    </div>

    <script>
      const editor = document.getElementById("editor");
      const preview = document.getElementById("preview");
      const titleEl = document.getElementById("postTitle");
      const keyDraft = "postDraft";
      const postsKey = "posts";

      function loadDraft() {
        const d = JSON.parse(localStorage.getItem(keyDraft) || "null");
        if (!d) return;
        titleEl.value = d.title || "";
        editor.innerHTML = d.content || "";
        document.getElementById("tags").value = (d.tags || []).join(",");
        document.getElementById("status").value = d.status || "draft";
        updatePreview();
      }

      function saveDraft() {
        const draft = {
          title: titleEl.value.trim(),
          content: editor.innerHTML,
          tags: (document.getElementById("tags").value || "")
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean),
          status: document.getElementById("status").value,
          updated: Date.now(),
        };
        localStorage.setItem(keyDraft, JSON.stringify(draft));
        toast("임시저장 완료");
      }

      function publish() {
        const posts = JSON.parse(localStorage.getItem(postsKey) || "[]");
        const post = {
          id: "p_" + Date.now(),
          title: titleEl.value.trim() || "무제",
          content: editor.innerHTML,
          tags: (document.getElementById("tags").value || "")
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean),
          status: document.getElementById("status").value,
          created: Date.now(),
        };
        posts.unshift(post);
        localStorage.setItem(postsKey, JSON.stringify(posts));
        toast("로컬에 발행되었습니다");
      }

      function deleteDraft() {
        localStorage.removeItem(keyDraft);
        titleEl.value = "";
        editor.innerHTML = "";
        document.getElementById("tags").value = "";
        document.getElementById("status").value = "draft";
        updatePreview();
        toast("임시 삭제됨");
      }

      function updatePreview() {
        preview.innerHTML =
          editor.innerHTML || "<i>미리보기가 비어 있습니다.</i>";
      }

      document.querySelectorAll(".toolbar button[data-cmd]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const cmd = btn.getAttribute("data-cmd");
          if (cmd === "link") {
            const url = prompt("링크 URL을 입력하세요", "https://");
            if (url) document.execCommand("createLink", false, url);
          } else {
            document.execCommand(cmd, false, null);
          }
          editor.focus();
          updatePreview();
        });
      });

      document.getElementById("saveDraft").addEventListener("click", saveDraft);
      document.getElementById("loadDraft").addEventListener("click", loadDraft);
      document
        .getElementById("deleteDraft")
        .addEventListener("click", deleteDraft);
      document.getElementById("exportBtn").addEventListener("click", () => {
        const text =
          "# " +
          (titleEl.value || "무제") +
          "\n\n" +
          (editor.innerText || "").trim();
        const blob = new Blob([text], { type: "text/markdown;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = (titleEl.value || "untitled") + ".md";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });
      document.getElementById("publishBtn").addEventListener("click", publish);
      document.getElementById("clearDraft").addEventListener("click", () => {
        if (confirm("편집창을 초기화하시겠습니까?")) {
          editor.innerHTML = "";
          updatePreview();
        }
      });
      document.getElementById("togglePreview").addEventListener("click", () => {
        preview.parentElement.style.display =
          preview.parentElement.style.display === "none" ? "" : "none";
      });

      window.addEventListener("keydown", (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "s") {
          e.preventDefault();
          saveDraft();
        }
      });

      let autoSaveTimer;
      editor.addEventListener("input", () => {
        updatePreview();
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(saveDraft, 1200);
      });
      titleEl.addEventListener("input", () => {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(saveDraft, 1200);
      });

      function toast(msg) {
        const t = document.createElement("div");
        t.textContent = msg;
        t.style.position = "fixed";
        t.style.right = "18px";
        t.style.bottom = "18px";
        t.style.background = "rgba(15,23,42,0.92)";
        t.style.color = "#fff";
        t.style.padding = "10px 14px";
        t.style.borderRadius = "8px";
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 1600);
      }

      loadDraft();
      updatePreview();
    </script>
  </body>
</html>
